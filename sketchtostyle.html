<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sketch to Style | My Stylist</title>

<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Poppins",sans-serif;}
body{
  background:linear-gradient(135deg,#ffe6f7,#f8e6ff,#ffffff);
  color:#333;min-height:100vh;display:flex;flex-direction:column;
}
header{
  display:flex;align-items:center;justify-content:space-between;
  padding:20px 40px;background:rgba(255,255,255,0.3);
  backdrop-filter:blur(15px);box-shadow:0 4px 25px rgba(216,187,255,0.3);
  position:sticky;top:0;z-index:10;
}
header h1{
  font-family:"Dancing Script",cursive;font-size:2.5rem;
  background:linear-gradient(120deg,#e3a3b5,#b38bff,#f6d9f3);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  animation:shimmer 6s infinite linear;
}
@keyframes shimmer{0%{background-position:0% center;}100%{background-position:200% center;}}
.go-back{
  background:#b38bff;color:#fff;padding:8px 15px;border-radius:12px;
  text-decoration:none;box-shadow:0 0 15px rgba(179,139,255,0.6);
}
.container{
  width:95%;max-width:1100px;margin:40px auto;
  background:rgba(255,255,255,0.35);backdrop-filter:blur(15px);
  border-radius:25px;box-shadow:0 0 25px rgba(179,139,255,0.4);
  padding:30px 40px;display:flex;flex-direction:column;gap:30px;
}
.title{text-align:center;font-family:"Dancing Script",cursive;font-size:2.3rem;color:#7d57c9;}
.chat-box{
  background:rgba(255,255,255,0.5);
  border-radius:20px;box-shadow:inset 0 0 20px rgba(179,139,255,0.3);
  padding:20px;min-height:350px;overflow-y:auto;
  display:flex;flex-direction:column;gap:15px;
}
.msg{padding:12px 16px;border-radius:18px;max-width:75%;}
.user-msg{align-self:flex-end;background:linear-gradient(120deg,#d5b3ff,#b38bff);color:#fff;}
.ai-msg{align-self:flex-start;background:rgba(255,255,255,0.85);}
.preview-card{
  width:150px;height:190px;border-radius:15px;overflow:hidden;
  box-shadow:0 0 25px rgba(179,139,255,0.4);
}
.preview-card img{width:100%;height:100%;object-fit:cover;}
.typing{font-style:italic;color:#7d57c9;}
.input-area{display:flex;gap:10px;}
.input-area textarea{flex:1;height:70px;border-radius:15px;padding:12px;border:none;}
.input-area button{background:#b38bff;color:white;border:none;border-radius:15px;padding:12px 20px;}
.uploads{display:flex;justify-content:center;gap:20px;}
.upload-btn{background:#b38bff;color:#fff;padding:10px 20px;border-radius:15px;cursor:pointer;}
#uploadSketch,#uploadFabric{display:none;}
</style>
</head>

<body>

<header>
  <a class="go-back" href="home.html">‚Üê Go Back</a>
  <h1>Sketch to Style</h1>
</header>

<div class="container">
  <h2 class="title">Turn Your Sketch into a Masterpiece ‚ú®</h2>

  <div class="chat-box" id="chatBox"></div>

  <div class="input-area">
    <textarea id="userInput" placeholder="Describe your design..."></textarea>
    <button onclick="sendMessage()">Ask AI</button>
  </div>

  <div class="uploads">
    <label for="uploadSketch" class="upload-btn">Upload Sketch</label>
    <label for="uploadFabric" class="upload-btn">Upload Fabric</label>
  </div>

  <input type="file" id="uploadSketch" accept="image/*" onchange="handleUpload(event)">
  <input type="file" id="uploadFabric" accept="image/*" onchange="handleUpload(event)">
</div>

<script>
const chatBox = document.getElementById("chatBox");
const userInput = document.getElementById("userInput");

function getCurrentUserId(){
  return localStorage.getItem('userUid') || localStorage.getItem('username') || 'guest';
}
function getStorageKey(){ return `sketchToStyleChat_${getCurrentUserId()}`; }

const aiImages = [
 "https://i.pinimg.com/236x/57/06/c1/5706c14d897ee1f03614c508a1cea01d.jpg",
 "https://0f40710f02531d0a1b40-412b43ec9fb2eb88d4bdda07eee33af6.ssl.cf2.rackcdn.com/product-longrect-3324477-219184-1675060141-24b91f7637700d65c8c0834797647bc3.jpg"
];
let aiIndex = 0;

// Load chat only for the current user. Do not fall back to the generic key
// to avoid showing another user's chat after a different login.
if(localStorage.getItem('sketchToStyleChat') && getCurrentUserId() !== 'guest'){
  // remove the old generic key to avoid accidental leakage
  try{ localStorage.removeItem('sketchToStyleChat'); }catch(e){}
}
let chatHistory = JSON.parse(localStorage.getItem(getStorageKey()) || '[]');

/* ---------- Render ---------- */
function renderChat(){
  chatBox.innerHTML="";
  if(chatHistory.length===0){
    addMessage("üëó Upload a sketch or fabric and ask me to style it!","ai-msg",false);
    return;
  }
  chatHistory.forEach(item=>{
    if(item.type==="image"){
      addImage(item.src,false);
    }else{
      addMessage(item.text,item.type,false);
    }
  });
}
renderChat();

/* ---------- Helpers ---------- */
function saveChat(){ localStorage.setItem(getStorageKey(),JSON.stringify(chatHistory)); }

function addMessage(text,type,save=true){
  const div=document.createElement("div");
  div.className=`msg ${type}`;
  div.textContent=text;
  chatBox.appendChild(div);
  chatBox.scrollTop=chatBox.scrollHeight;
  if(save){ chatHistory.push({type,text}); saveChat(); }
}

function addImage(src,save=true){
  const card=document.createElement("div");
  card.className="preview-card";
  card.innerHTML=`<img src="${src}">`;
  chatBox.appendChild(card);
  chatBox.scrollTop=chatBox.scrollHeight;
  if(save){ chatHistory.push({type:"image",src}); saveChat(); }
}

/* ---------- Upload ---------- */
function handleUpload(e){
  const file=e.target.files[0];
  if(!file)return;
  const reader=new FileReader();
  reader.onload=()=>{
    addMessage("üì∏ Image uploaded","ai-msg");
    addImage(reader.result);
  };
  reader.readAsDataURL(file);
}

/* ---------- AI ---------- */
function sendMessage(){
  const q=userInput.value.trim();
  if(!q)return;
  addMessage(q,"user-msg");
  userInput.value="";

  const typing=document.createElement("div");
  typing.className="typing";
  typing.textContent="AI is creating your design...";
  chatBox.appendChild(typing);
  chatBox.scrollTop=chatBox.scrollHeight;

  setTimeout(()=>{
    typing.remove();
    addMessage("‚ú® Here‚Äôs your styled look","ai-msg");
    addImage(aiImages[aiIndex]);
    aiIndex=(aiIndex+1)%aiImages.length;
  },4000);
}
</script>

</body>
</html>