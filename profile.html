<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>My Stylist | Profile</title>

<!-- Fonts & Icons -->
<link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
/* ===== ORIGINAL THEME (UNCHANGED) ===== */
*{margin:0;padding:0;box-sizing:border-box;font-family:"Poppins",sans-serif;}
body{
  background:linear-gradient(135deg,#f3e8ff,#fff0fa,#f5e8ff);
  min-height:100vh;display:flex;flex-direction:column;align-items:center;
  justify-content:flex-start;color:#333;overflow-x:hidden;
}

/* Header */
header{
  width:100%;display:flex;justify-content:space-between;align-items:center;
  padding:20px 60px;position:sticky;top:0;z-index:10;
  background:rgba(255,255,255,0.4);backdrop-filter:blur(15px);
  box-shadow:0 4px 25px rgba(216,187,255,0.3);
  border-bottom:1px solid rgba(255,255,255,0.5);
}
header h1{
  font-family:"Dancing Script",cursive;font-size:2.4rem;
  background:linear-gradient(120deg,#e3a3b5,#b38bff,#f6d9f3);
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  background-size:200% auto;animation:shimmer 6s infinite linear;
}
@keyframes shimmer{0%{background-position:0% center;}100%{background-position:200% center;}}
.go-back{
  font-size:1rem;background:#b38bff;color:#fff;padding:8px 18px;border-radius:12px;
  cursor:pointer;text-decoration:none;box-shadow:0 0 15px rgba(179,139,255,0.5);
}

/* Profile Card */
.profile-card{
  margin-top:60px;width:90%;max-width:700px;background:rgba(255,255,255,0.4);
  backdrop-filter:blur(20px);border-radius:25px;
  box-shadow:0 0 40px rgba(179,139,255,0.4);
  padding:40px 50px;text-align:center;
}
.profile-card h2{
  font-family:"Dancing Script",cursive;font-size:2.3rem;color:#7d57c9;
  margin-bottom:30px;
}

/* Fields */
.profile-info{display:flex;flex-direction:column;gap:25px;}
.field{
  width:100%;display:flex;align-items:center;justify-content:space-between;
  background:rgba(255,255,255,0.6);border-radius:15px;
  padding:12px 18px;position:relative;
}
.field label{font-weight:500;color:#6a4dad;width:30%;}
.field input{
  width:65%;border:none;outline:none;font-size:1rem;
  background:transparent;color:#4b3a7a;
}
.eye-icon{
  position:absolute;right:15px;color:#8f7be6;font-size:1.2rem;
  cursor:pointer;display:none;
}

/* Buttons */
.btn-container{
  margin-top:40px;display:flex;justify-content:center;gap:20px;
}
button{
  background:#b38bff;color:#fff;border:none;border-radius:15px;
  padding:12px 25px;cursor:pointer;font-size:1rem;
  box-shadow:0 0 15px rgba(179,139,255,0.4);
  transition:all 0.3s ease;
}
button:hover{transform:scale(1.05);}

/* Glow highlight */
.glow-btn{animation:glowPulse 2s infinite;}
@keyframes glowPulse{
  0%{box-shadow:0 0 10px rgba(179,139,255,0.5);}
  50%{box-shadow:0 0 30px rgba(179,139,255,0.9);}
  100%{box-shadow:0 0 10px rgba(179,139,255,0.5);}
}

footer{margin-top:60px;padding:20px;color:#777;font-size:0.9rem;text-align:center;}
</style>
</head>

<body>

<header>
  <a class="go-back" href="home.html">‚Üê Home</a>
  <h1>My Stylist Profile</h1>
</header>

<div class="profile-card">
  <h2>Your Profile Details ‚ú®</h2>

  <div class="profile-info">
    <div class="field">
      <label>Username</label>
      <input id="username" readonly>
    </div>

    <div class="field">
      <label>Email</label>
      <input id="email" readonly>
    </div>

    <div class="field">
      <label>Password</label>
      <input id="password" type="password" value="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" readonly>
      <i class="fa-solid fa-eye eye-icon" id="togglePassword"></i>
    </div>

    <div class="field">
      <label>Phone</label>
      <input id="phone" readonly>
    </div>

    <div class="field">
      <label>Preferred Style</label>
      <input id="style" readonly>
    </div>
  </div>

  <div class="btn-container">
    <button id="editBtn" class="glow-btn">Edit</button>
    <button id="saveBtn">Save</button>
  </div>
</div>

<footer>¬© 2025 My Stylist ‚Ä¢ Designed with üíú Lavender Aesthetics</footer>

<!-- üî• FIREBASE LOGIC -->
<script type="module">
import { auth, db } from "./firebase.js";
import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const usernameInput = document.getElementById("username");
const emailInput = document.getElementById("email");
const phoneInput = document.getElementById("phone");
const styleInput = document.getElementById("style");
const passwordInput = document.getElementById("password");

const editBtn = document.getElementById("editBtn");
const saveBtn = document.getElementById("saveBtn");
const eye = document.getElementById("togglePassword");

let userRef;

// üî• LOAD USER
onAuthStateChanged(auth, async (user) => {
  if (!user) {
    window.location.href = "login.html";
    return;
  }

  // ‚úÖ EMAIL FROM SIGNUP (FIXED)
  emailInput.value = user.email;

  userRef = doc(db, "users", user.uid);
  const snap = await getDoc(userRef);

  if (snap.exists()) {
    const data = snap.data();
    usernameInput.value = data.username || "Fashionista";
    // keep a local copy so other pages (home) can show the updated name immediately
    localStorage.setItem('username', usernameInput.value);
    phoneInput.value = data.phone || "+91 9000000000";
    styleInput.value = data.style || "Chic & Minimal";
  } else {
    // defaults
    usernameInput.value = "Fashionista";
    phoneInput.value = "+91 9000000000";
    styleInput.value = "Chic & Minimal";

    await setDoc(userRef,{
      username: usernameInput.value,
      phone: phoneInput.value,
      style: styleInput.value,
      email: user.email
    });
    // persist locally as well
    localStorage.setItem('username', usernameInput.value);
  }
});

// ‚úè EDIT
editBtn.onclick = () => {
  [usernameInput, phoneInput, styleInput].forEach(i=>i.removeAttribute("readonly"));
  eye.style.display = "block";
  editBtn.classList.remove("glow-btn");
  saveBtn.classList.add("glow-btn");
};

// üíæ SAVE
saveBtn.onclick = async () => {
  await setDoc(userRef,{
    username: usernameInput.value,
    phone: phoneInput.value,
    style: styleInput.value
  },{merge:true});

  // update local copy so other pages reflect change immediately
  localStorage.setItem('username', usernameInput.value);

  [usernameInput, phoneInput, styleInput].forEach(i=>i.setAttribute("readonly",true));
  eye.style.display = "none";
  saveBtn.classList.remove("glow-btn");
  editBtn.classList.add("glow-btn");

  alert("üíú Profile updated successfully!");
};

// üëÅ Password toggle (visual only)
eye.onclick = () => {
  passwordInput.type = passwordInput.type === "password" ? "text" : "password";
};
</script>

</body>
</html>